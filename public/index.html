<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”’</text></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="SSL Certificate Management Tool for Nginx" />
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <title>SSL Certificate Manager</title>
    
    <style>
        /* Custom CSS for SSL Certificate Manager */
        .App {
          min-height: 100vh;
          background-color: #f8f9fa;
        }
        
        .cursor-pointer {
          cursor: pointer;
        }
        
        .notification-container {
          position: fixed;
          top: 80px;
          right: 20px;
          z-index: 1050;
          max-width: 400px;
        }
        
        .notification-container .alert {
          margin-bottom: 10px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          border: none;
        }
        
        .table-hover tbody tr:hover {
          background-color: rgba(0, 123, 255, 0.05);
        }
        
        .table tbody tr.table-active {
          background-color: rgba(0, 123, 255, 0.1);
          border-left: 4px solid #007bff;
        }
        
        .card {
          border: none;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          transition: box-shadow 0.2s ease-in-out;
        }
        
        .card:hover {
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
          background-color: #fff;
          border-bottom: 1px solid #dee2e6;
          font-weight: 600;
        }
        
        .btn {
          border-radius: 6px;
          font-weight: 500;
          transition: all 0.2s ease-in-out;
        }
        
        .btn:hover {
          transform: translateY(-1px);
        }
        
        .badge {
          font-weight: 500;
          padding: 0.5em 0.75em;
        }
        
        .font-monospace {
          font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
          font-size: 0.875em;
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        .fa-spinner {
          animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- React Application -->
    <script type="text/babel">
        // API Service
        const api = {
          baseURL: '/api',
          timeout: 60000,
          
          request: async (method, url, data = null) => {
            try {
              const config = {
                method,
                url: `${api.baseURL}${url}`,
                timeout: api.timeout,
                headers: { 'Content-Type': 'application/json' }
              };
              
              if (data) {
                config.data = data;
              }
              
              const response = await axios(config);
              return response;
            } catch (error) {
              console.error('API Error:', error);
              throw error;
            }
          },
          
          getDomains: () => api.request('GET', '/domains'),
          getDomain: (domain) => api.request('GET', `/domains/domain/${encodeURIComponent(domain)}`),
          refreshDomains: () => api.request('POST', '/domains/refresh'),
          getSSLStatus: (domain) => api.request('GET', `/ssl/status/${encodeURIComponent(domain)}`),
          installSSL: (domain, email) => api.request('POST', '/ssl/install', { domain, email }),
          renewSSL: (domain) => api.request('POST', '/ssl/renew', { domain }),
          renewAllSSL: () => api.request('POST', '/ssl/renew-all'),
          healthCheck: () => api.request('GET', '/health')
        };

        // DomainList Component
        const DomainList = ({ domains, onDomainSelect, selectedDomain, loading }) => {
          const getSSLStatusBadge = (ssl) => {
            if (!ssl) return React.createElement('span', { className: 'badge bg-secondary' }, 'Unknown');
            if (ssl.status === 'error') return React.createElement('span', { className: 'badge bg-danger' }, 'Error');
            if (!ssl.hasSSL) return React.createElement('span', { className: 'badge bg-warning' }, 'No SSL');
            if (ssl.isExpired) return React.createElement('span', { className: 'badge bg-danger' }, 'Expired');
            if (ssl.isExpiringSoon) return React.createElement('span', { className: 'badge bg-warning' }, 'Expiring Soon');
            return React.createElement('span', { className: 'badge bg-success' }, 'Valid');
          };

          const getSSLIcon = (ssl) => {
            if (!ssl || !ssl.hasSSL) return React.createElement('i', { className: 'fas fa-unlock text-muted' });
            if (ssl.isExpired) return React.createElement('i', { className: 'fas fa-times-circle text-danger' });
            if (ssl.isExpiringSoon) return React.createElement('i', { className: 'fas fa-exclamation-triangle text-warning' });
            return React.createElement('i', { className: 'fas fa-shield-alt text-success' });
          };

          const formatExpiryDate = (ssl) => {
            if (!ssl || !ssl.hasSSL || !ssl.expiryDate) return 'N/A';
            const date = new Date(ssl.expiryDate);
            return date.toLocaleDateString();
          };

          const getDaysUntilExpiry = (ssl) => {
            if (!ssl || !ssl.hasSSL || ssl.daysUntilExpiry === undefined) return 'N/A';
            if (ssl.daysUntilExpiry <= 0) return 'Expired';
            return `${ssl.daysUntilExpiry} days`;
          };

          if (loading && domains.length === 0) {
            return React.createElement('div', { className: 'text-center py-4' },
              React.createElement('div', { className: 'spinner-border text-primary', role: 'status' },
                React.createElement('span', { className: 'visually-hidden' }, 'Loading...')
              ),
              React.createElement('p', { className: 'mt-2 text-muted' }, 'Loading domains...')
            );
          }

          if (domains.length === 0) {
            return React.createElement('div', { className: 'text-center py-5' },
              React.createElement('i', { className: 'fas fa-server fa-3x text-muted mb-3' }),
              React.createElement('h5', { className: 'text-muted' }, 'No Domains Found'),
              React.createElement('p', { className: 'text-muted' }, 'No nginx server configurations found in /etc/nginx/sites-available/'),
              React.createElement('small', { className: 'text-muted' }, 'Make sure nginx is properly configured and you have the necessary permissions.')
            );
          }

          return React.createElement('div', { className: 'table-responsive' },
            React.createElement('table', { className: 'table table-hover mb-0' },
              React.createElement('thead', { className: 'table-light' },
                React.createElement('tr', null,
                  React.createElement('th', null, 'Domain'),
                  React.createElement('th', null, 'SSL Status'),
                  React.createElement('th', null, 'Expires'),
                  React.createElement('th', null, 'Days Left'),
                  React.createElement('th', null, 'Enabled')
                )
              ),
              React.createElement('tbody', null,
                domains.map((domain, index) =>
                  React.createElement('tr', {
                    key: `${domain.domain}-${index}`,
                    className: `cursor-pointer ${selectedDomain?.domain === domain.domain ? 'table-active' : ''}`,
                    onClick: () => onDomainSelect(domain),
                    style: { cursor: 'pointer' }
                  },
                    React.createElement('td', null,
                      React.createElement('div', { className: 'd-flex align-items-center' },
                        getSSLIcon(domain.ssl),
                        React.createElement('div', { className: 'ms-2' },
                          React.createElement('div', { className: 'fw-medium' }, domain.domain),
                          domain.serverNames && domain.serverNames.length > 1 &&
                          React.createElement('small', { className: 'text-muted' }, `+${domain.serverNames.length - 1} more`)
                        )
                      )
                    ),
                    React.createElement('td', null,
                      getSSLStatusBadge(domain.ssl),
                      domain.ssl?.issuerOrg &&
                      React.createElement('small', { className: 'd-block text-muted mt-1' }, domain.ssl.issuerOrg)
                    ),
                    React.createElement('td', null,
                      React.createElement('span', {
                        className: domain.ssl?.isExpired ? 'text-danger' : domain.ssl?.isExpiringSoon ? 'text-warning' : ''
                      }, formatExpiryDate(domain.ssl))
                    ),
                    React.createElement('td', null,
                      React.createElement('span', {
                        className: domain.ssl?.isExpired ? 'text-danger fw-bold' : domain.ssl?.isExpiringSoon ? 'text-warning fw-bold' : ''
                      }, getDaysUntilExpiry(domain.ssl))
                    ),
                    React.createElement('td', null,
                      domain.enabled ?
                        React.createElement('span', { className: 'badge bg-success' },
                          React.createElement('i', { className: 'fas fa-check' }), ' Enabled'
                        ) :
                        React.createElement('span', { className: 'badge bg-secondary' },
                          React.createElement('i', { className: 'fas fa-times' }), ' Disabled'
                        )
                    )
                  )
                )
              )
            )
          );
        };

        // SSLStatus Component
        const SSLStatus = ({ domain }) => {
          const ssl = domain.ssl;

          const getStatusColor = () => {
            if (!ssl || !ssl.hasSSL) return 'text-muted';
            if (ssl.isExpired) return 'text-danger';
            if (ssl.isExpiringSoon) return 'text-warning';
            return 'text-success';
          };

          const getStatusIcon = () => {
            if (!ssl || !ssl.hasSSL) return 'fas fa-unlock';
            if (ssl.isExpired) return 'fas fa-times-circle';
            if (ssl.isExpiringSoon) return 'fas fa-exclamation-triangle';
            return 'fas fa-shield-alt';
          };

          const formatDate = (dateString) => {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleString();
          };

          return React.createElement('div', { className: 'card mb-3' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('h6', { className: 'mb-0' },
                React.createElement('i', { className: 'fas fa-certificate me-2' }),
                'SSL Certificate Status'
              )
            ),
            React.createElement('div', { className: 'card-body' },
              React.createElement('div', { className: 'd-flex align-items-center mb-3' },
                React.createElement('i', { className: `${getStatusIcon()} fa-2x ${getStatusColor()} me-3` }),
                React.createElement('div', null,
                  React.createElement('h5', { className: 'mb-1' }, domain.domain),
                  React.createElement('p', { className: 'mb-0 text-muted' }, domain.filename)
                )
              ),

              ssl?.error ?
                React.createElement('div', { className: 'alert alert-danger', role: 'alert' },
                  React.createElement('i', { className: 'fas fa-exclamation-triangle me-2' }),
                  React.createElement('strong', null, 'Error:'), ' ', ssl.error
                ) :
                ssl?.hasSSL ?
                  React.createElement('div', null,
                    // Certificate Details
                    React.createElement('div', { className: 'row g-2 mb-3' },
                      React.createElement('div', { className: 'col-sm-6' },
                        React.createElement('div', { className: 'card bg-light' },
                          React.createElement('div', { className: 'card-body p-3' },
                            React.createElement('h6', { className: 'card-title mb-2' },
                              React.createElement('i', { className: 'fas fa-calendar-alt me-1' }),
                              'Expires In'
                            ),
                            React.createElement('p', {
                              className: `card-text mb-0 ${ssl.isExpired ? 'text-danger fw-bold' : ssl.isExpiringSoon ? 'text-warning fw-bold' : 'text-success'}`
                            }, ssl.daysUntilExpiry !== undefined ? (ssl.daysUntilExpiry <= 0 ? 'Expired' : `${ssl.daysUntilExpiry} days`) : 'Unknown')
                          )
                        )
                      ),
                      React.createElement('div', { className: 'col-sm-6' },
                        React.createElement('div', { className: 'card bg-light' },
                          React.createElement('div', { className: 'card-body p-3' },
                            React.createElement('h6', { className: 'card-title mb-2' },
                              React.createElement('i', { className: 'fas fa-building me-1' }),
                              'Issuer'
                            ),
                            React.createElement('p', { className: 'card-text mb-0 small' }, ssl.issuerOrg || 'Unknown')
                          )
                        )
                      )
                    ),

                    // Status Alerts
                    ssl.isExpired &&
                    React.createElement('div', { className: 'alert alert-danger', role: 'alert' },
                      React.createElement('i', { className: 'fas fa-times-circle me-2' }),
                      React.createElement('strong', null, 'Certificate Expired!'), ' This certificate has expired and needs immediate renewal.'
                    ),

                    ssl.isExpiringSoon && !ssl.isExpired &&
                    React.createElement('div', { className: 'alert alert-warning', role: 'alert' },
                      React.createElement('i', { className: 'fas fa-exclamation-triangle me-2' }),
                      React.createElement('strong', null, 'Certificate Expiring Soon!'), ` This certificate will expire in ${ssl.daysUntilExpiry} days.`
                    ),

                    !ssl.isExpired && !ssl.isExpiringSoon &&
                    React.createElement('div', { className: 'alert alert-success', role: 'alert' },
                      React.createElement('i', { className: 'fas fa-check-circle me-2' }),
                      React.createElement('strong', null, 'Certificate Valid!'), ' This certificate is valid and up to date.'
                    )
                  ) :
                  React.createElement('div', null,
                    React.createElement('div', { className: 'alert alert-warning', role: 'alert' },
                      React.createElement('i', { className: 'fas fa-unlock me-2' }),
                      React.createElement('strong', null, 'No SSL Certificate'),
                      React.createElement('p', { className: 'mb-0 mt-2' }, 'This domain does not have an SSL certificate configured. You can install one using the actions panel.')
                    )
                  )
            )
          );
        };

        // CertificateActions Component  
        const CertificateActions = ({ domain, onSSLAction }) => {
          const [loading, setLoading] = React.useState(false);
          const [email, setEmail] = React.useState('');
          const [showInstallForm, setShowInstallForm] = React.useState(false);
          const [error, setError] = React.useState(null);

          const handleInstallSSL = async (e) => {
            e.preventDefault();
            if (!email) {
              setError('Email address is required');
              return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
              setError('Please enter a valid email address');
              return;
            }

            try {
              setLoading(true);
              setError(null);
              await onSSLAction('install', domain.domain, { email });
              setShowInstallForm(false);
              setEmail('');
            } catch (err) {
              setError(err.response?.data?.message || 'Failed to install SSL certificate');
            } finally {
              setLoading(false);
            }
          };

          const handleRenewSSL = async () => {
            try {
              setLoading(true);
              setError(null);
              await onSSLAction('renew', domain.domain);
            } catch (err) {
              setError(err.response?.data?.message || 'Failed to renew SSL certificate');
            } finally {
              setLoading(false);
            }
          };

          const handleRenewAllSSL = async () => {
            try {
              setLoading(true);
              setError(null);
              await onSSLAction('renewAll');
            } catch (err) {
              setError(err.response?.data?.message || 'Failed to renew all SSL certificates');
            } finally {
              setLoading(false);
            }
          };

          const ssl = domain.ssl;
          const hasSSL = ssl?.hasSSL;

          return React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('h6', { className: 'mb-0' },
                React.createElement('i', { className: 'fas fa-tools me-2' }),
                'Certificate Actions'
              )
            ),
            React.createElement('div', { className: 'card-body' },
              error &&
              React.createElement('div', { className: 'alert alert-danger alert-dismissible fade show', role: 'alert' },
                React.createElement('i', { className: 'fas fa-exclamation-triangle me-2' }),
                error,
                React.createElement('button', {
                  type: 'button',
                  className: 'btn-close',
                  onClick: () => setError(null),
                  'aria-label': 'Close'
                })
              ),

              !hasSSL &&
              React.createElement('div', { className: 'mb-3' },
                React.createElement('h6', { className: 'text-muted mb-2' }, 'Install SSL Certificate'),
                !showInstallForm ?
                  React.createElement('button', {
                    className: 'btn btn-success w-100',
                    onClick: () => setShowInstallForm(true),
                    disabled: loading
                  },
                    React.createElement('i', { className: 'fas fa-plus me-2' }),
                    'Install SSL Certificate'
                  ) :
                  React.createElement('form', { onSubmit: handleInstallSSL },
                    React.createElement('div', { className: 'mb-3' },
                      React.createElement('label', { htmlFor: 'email', className: 'form-label' },
                        'Email Address ',
                        React.createElement('span', { className: 'text-danger' }, '*')
                      ),
                      React.createElement('input', {
                        type: 'email',
                        className: 'form-control',
                        id: 'email',
                        value: email,
                        onChange: (e) => setEmail(e.target.value),
                        placeholder: 'admin@example.com',
                        required: true,
                        disabled: loading
                      }),
                      React.createElement('div', { className: 'form-text' }, 'Required for Let\'s Encrypt certificate registration and notifications.')
                    ),
                    React.createElement('div', { className: 'd-grid gap-2' },
                      React.createElement('button', {
                        type: 'submit',
                        className: 'btn btn-success',
                        disabled: loading
                      }, loading ?
                        React.createElement(React.Fragment, null,
                          React.createElement('i', { className: 'fas fa-spinner fa-spin me-2' }),
                          'Installing...'
                        ) :
                        React.createElement(React.Fragment, null,
                          React.createElement('i', { className: 'fas fa-download me-2' }),
                          'Install Certificate'
                        )
                      ),
                      React.createElement('button', {
                        type: 'button',
                        className: 'btn btn-outline-secondary',
                        onClick: () => {
                          setShowInstallForm(false);
                          setEmail('');
                          setError(null);
                        },
                        disabled: loading
                      }, 'Cancel')
                    )
                  )
              ),

              hasSSL &&
              React.createElement('div', { className: 'mb-3' },
                React.createElement('h6', { className: 'text-muted mb-2' }, 'Manage Certificate'),
                React.createElement('div', { className: 'd-grid gap-2' },
                  React.createElement('button', {
                    className: 'btn btn-primary',
                    onClick: handleRenewSSL,
                    disabled: loading
                  }, loading ?
                    React.createElement(React.Fragment, null,
                      React.createElement('i', { className: 'fas fa-spinner fa-spin me-2' }),
                      'Renewing...'
                    ) :
                    React.createElement(React.Fragment, null,
                      React.createElement('i', { className: 'fas fa-sync-alt me-2' }),
                      'Renew Certificate'
                    )
                  )
                )
              ),

              React.createElement('hr'),

              React.createElement('div', { className: 'mb-3' },
                React.createElement('h6', { className: 'text-muted mb-2' }, 'Bulk Actions'),
                React.createElement('div', { className: 'd-grid' },
                  React.createElement('button', {
                    className: 'btn btn-outline-primary',
                    onClick: handleRenewAllSSL,
                    disabled: loading
                  }, loading ?
                    React.createElement(React.Fragment, null,
                      React.createElement('i', { className: 'fas fa-spinner fa-spin me-2' }),
                      'Renewing All...'
                    ) :
                    React.createElement(React.Fragment, null,
                      React.createElement('i', { className: 'fas fa-sync me-2' }),
                      'Renew All Certificates'
                    )
                  )
                ),
                React.createElement('div', { className: 'form-text mt-2' }, 'This will attempt to renew all SSL certificates on the system.')
              )
            )
          );
        };

        // Dashboard Component
        const Dashboard = ({ socket }) => {
          const [domains, setDomains] = React.useState([]);
          const [loading, setLoading] = React.useState(true);
          const [error, setError] = React.useState(null);
          const [selectedDomain, setSelectedDomain] = React.useState(null);
          const [refreshing, setRefreshing] = React.useState(false);
          const [stats, setStats] = React.useState({
            total: 0,
            withSSL: 0,
            expiringSoon: 0,
            expired: 0
          });

          React.useEffect(() => {
            loadDomains();
          }, []);

          React.useEffect(() => {
            if (domains.length > 0) {
              calculateStats();
            }
          }, [domains]);

          React.useEffect(() => {
            if (socket) {
              socket.on('ssl_install_complete', () => {
                loadDomains();
              });

              socket.on('ssl_renew_complete', () => {
                loadDomains();
              });

              socket.on('domain_refresh_start', () => {
                setRefreshing(true);
              });

              socket.on('domain_refresh_complete', () => {
                setRefreshing(false);
                loadDomains();
              });

              socket.on('domain_refresh_error', () => {
                setRefreshing(false);
              });

              return () => {
                socket.off('ssl_install_complete');
                socket.off('ssl_renew_complete');
                socket.off('domain_refresh_start');
                socket.off('domain_refresh_complete');
                socket.off('domain_refresh_error');
              };
            }
          }, [socket]);

          const loadDomains = async () => {
            try {
              setLoading(true);
              setError(null);
              const response = await api.getDomains();
              setDomains(response.data.domains || []);
            } catch (err) {
              console.error('Error loading domains:', err);
              setError(err.response?.data?.message || 'Failed to load domains');
            } finally {
              setLoading(false);
            }
          };

          const refreshDomains = async () => {
            try {
              setRefreshing(true);
              await api.refreshDomains();
            } catch (err) {
              console.error('Error refreshing domains:', err);
              setError(err.response?.data?.message || 'Failed to refresh domains');
              setRefreshing(false);
            }
          };

          const calculateStats = () => {
            const total = domains.length;
            const withSSL = domains.filter(d => d.ssl?.hasSSL).length;
            const expiringSoon = domains.filter(d => 
              d.ssl?.hasSSL && d.ssl?.isExpiringSoon && !d.ssl?.isExpired
            ).length;
            const expired = domains.filter(d => 
              d.ssl?.hasSSL && d.ssl?.isExpired
            ).length;

            setStats({ total, withSSL, expiringSoon, expired });
          };

          const handleDomainSelect = (domain) => {
            setSelectedDomain(domain);
          };

          const handleSSLAction = async (action, domain, data) => {
            try {
              switch (action) {
                case 'install':
                  await api.installSSL(domain, data.email);
                  break;
                case 'renew':
                  await api.renewSSL(domain);
                  break;
                case 'renewAll':
                  await api.renewAllSSL();
                  break;
                default:
                  throw new Error('Unknown SSL action');
              }
            } catch (err) {
              console.error(`Error performing SSL action ${action}:`, err);
              throw err;
            }
          };

          if (loading && domains.length === 0) {
            return React.createElement('div', { className: 'text-center py-5' },
              React.createElement('div', { className: 'spinner-border text-primary mb-3', role: 'status' },
                React.createElement('span', { className: 'visually-hidden' }, 'Loading...')
              ),
              React.createElement('h4', null, 'Loading domains...'),
              React.createElement('p', { className: 'text-muted' }, 'Scanning nginx configuration files...')
            );
          }

          return React.createElement('div', { className: 'dashboard' },
            // Stats Overview
            React.createElement('div', { className: 'row mb-4' },
              React.createElement('div', { className: 'col-md-3' },
                React.createElement('div', { className: 'card bg-primary text-white' },
                  React.createElement('div', { className: 'card-body' },
                    React.createElement('div', { className: 'd-flex justify-content-between' },
                      React.createElement('div', null,
                        React.createElement('h5', { className: 'card-title' }, 'Total Domains'),
                        React.createElement('h2', { className: 'mb-0' }, stats.total)
                      ),
                      React.createElement('div', { className: 'align-self-center' },
                        React.createElement('i', { className: 'fas fa-globe fa-2x' })
                      )
                    )
                  )
                )
              ),
              React.createElement('div', { className: 'col-md-3' },
                React.createElement('div', { className: 'card bg-success text-white' },
                  React.createElement('div', { className: 'card-body' },
                    React.createElement('div', { className: 'd-flex justify-content-between' },
                      React.createElement('div', null,
                        React.createElement('h5', { className: 'card-title' }, 'With SSL'),
                        React.createElement('h2', { className: 'mb-0' }, stats.withSSL)
                      ),
                      React.createElement('div', { className: 'align-self-center' },
                        React.createElement('i', { className: 'fas fa-shield-alt fa-2x' })
                      )
                    )
                  )
                )
              ),
              React.createElement('div', { className: 'col-md-3' },
                React.createElement('div', { className: 'card bg-warning text-white' },
                  React.createElement('div', { className: 'card-body' },
                    React.createElement('div', { className: 'd-flex justify-content-between' },
                      React.createElement('div', null,
                        React.createElement('h5', { className: 'card-title' }, 'Expiring Soon'),
                        React.createElement('h2', { className: 'mb-0' }, stats.expiringSoon)
                      ),
                      React.createElement('div', { className: 'align-self-center' },
                        React.createElement('i', { className: 'fas fa-exclamation-triangle fa-2x' })
                      )
                    )
                  )
                )
              ),
              React.createElement('div', { className: 'col-md-3' },
                React.createElement('div', { className: 'card bg-danger text-white' },
                  React.createElement('div', { className: 'card-body' },
                    React.createElement('div', { className: 'd-flex justify-content-between' },
                      React.createElement('div', null,
                        React.createElement('h5', { className: 'card-title' }, 'Expired'),
                        React.createElement('h2', { className: 'mb-0' }, stats.expired)
                      ),
                      React.createElement('div', { className: 'align-self-center' },
                        React.createElement('i', { className: 'fas fa-times-circle fa-2x' })
                      )
                    )
                  )
                )
              )
            ),

            // Main Content
            React.createElement('div', { className: 'row' },
              // Domain List
              React.createElement('div', { className: 'col-lg-8' },
                React.createElement('div', { className: 'card' },
                  React.createElement('div', { className: 'card-header d-flex justify-content-between align-items-center' },
                    React.createElement('h5', { className: 'mb-0' },
                      React.createElement('i', { className: 'fas fa-list me-2' }),
                      'Domains'
                    ),
                    React.createElement('button', {
                      className: 'btn btn-outline-primary btn-sm',
                      onClick: refreshDomains,
                      disabled: refreshing
                    }, refreshing ?
                      React.createElement(React.Fragment, null,
                        React.createElement('i', { className: 'fas fa-spinner fa-spin me-1' }),
                        'Refreshing...'
                      ) :
                      React.createElement(React.Fragment, null,
                        React.createElement('i', { className: 'fas fa-sync-alt me-1' }),
                        'Refresh'
                      )
                    )
                  ),
                  React.createElement('div', { className: 'card-body p-0' },
                    error ?
                      React.createElement('div', { className: 'alert alert-danger m-3', role: 'alert' },
                        React.createElement('i', { className: 'fas fa-exclamation-triangle me-2' }),
                        error,
                        React.createElement('button', {
                          className: 'btn btn-outline-danger btn-sm ms-2',
                          onClick: loadDomains
                        }, 'Retry')
                      ) :
                      React.createElement(DomainList, {
                        domains: domains,
                        onDomainSelect: handleDomainSelect,
                        selectedDomain: selectedDomain,
                        loading: loading
                      })
                  )
                )
              ),

              // SSL Status & Actions
              React.createElement('div', { className: 'col-lg-4' },
                selectedDomain ?
                  React.createElement(React.Fragment, null,
                    React.createElement(SSLStatus, { domain: selectedDomain }),
                    React.createElement(CertificateActions, {
                      domain: selectedDomain,
                      onSSLAction: handleSSLAction
                    })
                  ) :
                  React.createElement('div', { className: 'card' },
                    React.createElement('div', { className: 'card-body text-center py-5' },
                      React.createElement('i', { className: 'fas fa-mouse-pointer fa-3x text-muted mb-3' }),
                      React.createElement('h5', { className: 'text-muted' }, 'Select a Domain'),
                      React.createElement('p', { className: 'text-muted' }, 'Click on a domain from the list to view SSL status and perform actions.')
                    )
                  )
              )
            )
          );
        };

        // Main App Component
        const App = () => {
          const [socket, setSocket] = React.useState(null);
          const [connectionStatus, setConnectionStatus] = React.useState('connecting');
          const [notifications, setNotifications] = React.useState([]);

          React.useEffect(() => {
            const newSocket = io();
            
            newSocket.on('connect', () => {
              console.log('Connected to server');
              setConnectionStatus('connected');
              setSocket(newSocket);
            });

            newSocket.on('disconnect', () => {
              console.log('Disconnected from server');
              setConnectionStatus('disconnected');
            });

            newSocket.on('connect_error', (error) => {
              console.error('Connection error:', error);
              setConnectionStatus('error');
            });

            // SSL operation listeners
            newSocket.on('ssl_install_progress', (data) => {
              addNotification('info', `Installing SSL for ${data.domain}: ${data.message}`, false);
            });

            newSocket.on('ssl_install_complete', (data) => {
              addNotification('success', `SSL certificate installed successfully for ${data.domain}`, true);
            });

            newSocket.on('ssl_install_error', (data) => {
              addNotification('error', `SSL installation failed for ${data.domain}: ${data.error}`, true);
            });

            newSocket.on('ssl_renew_progress', (data) => {
              addNotification('info', `Renewing SSL for ${data.domain}: ${data.message}`, false);
            });

            newSocket.on('ssl_renew_complete', (data) => {
              addNotification('success', `SSL certificate renewed successfully for ${data.domain}`, true);
            });

            newSocket.on('ssl_renew_error', (data) => {
              addNotification('error', `SSL renewal failed for ${data.domain}: ${data.error}`, true);
            });

            return () => {
              newSocket.close();
            };
          }, []);

          const addNotification = (type, message, persistent = false) => {
            const notification = {
              id: Date.now() + Math.random(),
              type,
              message,
              timestamp: new Date(),
              persistent
            };

            setNotifications(prev => [...prev, notification]);

            if (!persistent) {
              setTimeout(() => {
                setNotifications(prev => prev.filter(n => n.id !== notification.id));
              }, 5000);
            }
          };

          const removeNotification = (id) => {
            setNotifications(prev => prev.filter(n => n.id !== id));
          };

          const getConnectionStatusBadge = () => {
            const statusConfig = {
              connecting: { class: 'bg-warning', text: 'Connecting...', icon: 'fas fa-spinner fa-spin' },
              connected: { class: 'bg-success', text: 'Connected', icon: 'fas fa-check-circle' },
              disconnected: { class: 'bg-danger', text: 'Disconnected', icon: 'fas fa-times-circle' },
              error: { class: 'bg-danger', text: 'Connection Error', icon: 'fas fa-exclamation-triangle' }
            };

            const config = statusConfig[connectionStatus] || statusConfig.error;

            return React.createElement('span', { className: `badge ${config.class} d-flex align-items-center gap-1` },
              React.createElement('i', { className: config.icon }),
              config.text
            );
          };

          return React.createElement('div', { className: 'App' },
            // Header
            React.createElement('nav', { className: 'navbar navbar-dark bg-primary mb-4' },
              React.createElement('div', { className: 'container-fluid' },
                React.createElement('span', { className: 'navbar-brand mb-0 h1 d-flex align-items-center' },
                  React.createElement('i', { className: 'fas fa-shield-alt me-2' }),
                  'SSL Certificate Manager'
                ),
                React.createElement('div', { className: 'd-flex align-items-center gap-3' },
                  getConnectionStatusBadge(),
                  React.createElement('span', { className: 'text-light small' },
                    React.createElement('i', { className: 'fas fa-clock me-1' }),
                    new Date().toLocaleString()
                  )
                )
              )
            ),

            // Notifications
            notifications.length > 0 &&
            React.createElement('div', { className: 'container-fluid mb-3' },
              React.createElement('div', { className: 'notification-container' },
                notifications.map(notification =>
                  React.createElement('div', {
                    key: notification.id,
                    className: `alert alert-${notification.type === 'error' ? 'danger' : notification.type} alert-dismissible fade show`,
                    role: 'alert'
                  },
                    React.createElement('div', { className: 'd-flex align-items-start' },
                      React.createElement('div', { className: 'flex-grow-1' },
                        React.createElement('strong', null,
                          notification.type === 'success' && React.createElement('i', { className: 'fas fa-check-circle me-1' }),
                          notification.type === 'error' && React.createElement('i', { className: 'fas fa-exclamation-triangle me-1' }),
                          notification.type === 'info' && React.createElement('i', { className: 'fas fa-info-circle me-1' })
                        ),
                        notification.message,
                        React.createElement('small', { className: 'd-block text-muted mt-1' },
                          notification.timestamp.toLocaleTimeString()
                        )
                      ),
                      React.createElement('button', {
                        type: 'button',
                        className: 'btn-close',
                        onClick: () => removeNotification(notification.id),
                        'aria-label': 'Close'
                      })
                    )
                  )
                )
              )
            ),

            // Main Content
            React.createElement('div', { className: 'container-fluid' },
              connectionStatus === 'connected' ?
                React.createElement(Dashboard, { socket: socket }) :
                React.createElement('div', { className: 'text-center py-5' },
                  React.createElement('div', { className: 'spinner-border text-primary mb-3', role: 'status' },
                    React.createElement('span', { className: 'visually-hidden' }, 'Loading...')
                  ),
                  React.createElement('h4', { className: 'text-muted' }, 'Connecting to SSL Management Server...'),
                  React.createElement('p', { className: 'text-muted' }, 'Please ensure the backend server is running and accessible.')
                )
            ),

            // Footer
            React.createElement('footer', { className: 'bg-light mt-5 py-3' },
              React.createElement('div', { className: 'container-fluid text-center text-muted' },
                React.createElement('small', null,
                  React.createElement('i', { className: 'fas fa-lock me-1' }),
                  'SSL Certificate Manager - Manage your nginx domains and SSL certificates'
                )
              )
            )
          );
        };

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
